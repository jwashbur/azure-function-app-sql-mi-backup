<script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@7.0.5/dist/browser/signalr.min.js"></script>
<script>
  const progressBar = document.getElementById('progress-bar');
  const statusMsg = document.getElementById('status');

  // Establish SignalR connection
  const connection = new signalR.HubConnectionBuilder()
    .withUrl('/api')
    .configureLogging(signalR.LogLevel.Information)
    .build();

  connection.on("backupStatus", (msg) => {
    if (msg.status === "started") {
      progressBar.style.width = "0%";
      statusMsg.textContent = "Backup started...";
    } else if (msg.status === "progress") {
      const percent = msg.percent || 50;
      progressBar.style.width = percent + "%";
      statusMsg.textContent = `Backup in progress: ${percent}%`;
    } else if (msg.status === "complete") {
      progressBar.style.width = "100%";
      statusMsg.textContent = "âœ… Backup completed!";
    }
  });

  connection.start().catch(err => console.error("SignalR connection error:", err));

  // Button to trigger backup
  document.getElementById('btn').onclick = async () => {
    statusMsg.textContent = "Requesting backup...";
    const res = await fetch('/api/trigger-backup', { method: 'POST' });
    const result = await res.text();
    console.log("Triggered:", result);
  };
</script>
